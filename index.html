<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>–ë–ª–æ–∫–Ω–æ—Ç –ú–∞—à–∏–Ω–∏—Å—Ç–∞ ¬∑ Lite v2025.25e</title>
<meta name="theme-color" content="#d32f2f">
<link rel="apple-touch-icon" href="apple-touch-icon.png?v=202525e">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png?v=202525e">
<link rel="apple-touch-icon" sizes="167x167" href="apple-touch-icon-167x167.png?v=202525e">
<link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png?v=202525e">
<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;margin:0}
:root{--red:#d32f2f;--bg:#0f1420;--card:#161d2a;--line:#243246;--mut:#8aa0b6;--txt:#e9eef5}
body{background:var(--bg);color:var(--txt);font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
header{position:sticky;top:0;background:var(--red);color:#fff;padding:12px 14px;display:flex;justify-content:space-between;align-items:center}
h1{margin:0;font-size:18px}
.badge{font-size:12px;padding:2px 8px;border:1px solid rgba(255,255,255,.4);border-radius:999px}
.container{padding:12px 12px 84px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px;margin-bottom:10px}
.row{display:flex;gap:8px;align-items:center;margin:8px 0}
.row label{width:42%;color:var(--mut);font-size:14px}
.row input,.row select,.row textarea{flex:1;background:#0e1622;border:1px solid var(--line);color:var(--txt);padding:10px;border-radius:10px;font-size:16px}
.btn{background:#1b2738;color:#fff;border:1px solid var(--line);padding:10px 14px;border-radius:10px;font-size:15px}
.btn.primary{background:#fff;color:#d32f2f;border-color:#fff}
.small{font-size:12px}
.view{display:none}
.view.active{display:block}
.tabbar{position:fixed;left:0;right:0;bottom:0;height:70px;background:#121828;border-top:1px solid var(--line);display:flex}
.tabbar button{flex:1;background:transparent;border:none;color:#8aa0b6;font-size:12px;padding:6px 0}
.tabbar button.active{color:#fff}
.tabbar .ico{display:block;font-size:18px;margin-bottom:4px}
.progress{height:10px;border:1px solid var(--line);border-radius:999px;overflow:hidden;background:#0f2035}
.progress>div{height:100%;background:#d32f2f;width:0%}
.trip{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;padding:8px 0;border-bottom:1px solid #233246}
.trip:last-child{border-bottom:0}
</style>
</head>
<body>
<header>
  <h1>–ë–ª–æ–∫–Ω–æ—Ç –ú–∞—à–∏–Ω–∏—Å—Ç–∞</h1>
  <div class="badge">Lite v2025.25e</div>
</header>

<main class="container">
  <!-- –ì–ª–∞–≤–Ω–∞—è -->
  <section id="v-dashboard" class="view active">
    <div class="card">
      <div style="display:flex;justify-content:space-between"><b>–ú–µ—Å—è—á–Ω–∞—è –Ω–æ—Ä–º–∞</b><b id="mwNorm">‚Äî</b></div>
      <div class="progress" style="margin-top:6px"><div id="mwBar"></div></div>
      <div class="row"><label>–ù–æ—Ä–º–∞, —á/–º–µ—Å</label><input id="tar_norm" type="number" inputmode="decimal" placeholder="176" onchange="tarSave()" oninput="tarSave()"></div>
      <div class="row"><label>–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ</label><div id="mwWorked" class="small">‚Äî</div></div>
      <div class="row"><label>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</label><div id="mwPercent" class="small">‚Äî</div></div>
      <div class="row"><label>–û—Å—Ç–∞–ª–æ—Å—å/–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞</label><div id="mwRemain" class="small">‚Äî</div></div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <b>–ü–æ–µ–∑–¥–∫–∏</b>
        <button class="btn primary" onclick="addTripOpen()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
      </div>

      <div id="tripForm" class="card" style="display:none;margin-top:10px">
        <div class="row"><label>–î–∞—Ç–∞</label><input id="t_date" type="date"></div>
        <div class="row"><label>–ú–∞—Ä—à—Ä—É—Ç</label><input id="t_route" placeholder="–ú–∞–ª–æ—à—É–π–∫–∞ ‚Äî –û–±–æ–∑–µ—Ä—Å–∫–∞—è"></div>
        <div class="row"><label>–ß–∞—Å—ã</label><input id="t_hours" type="number" inputmode="decimal" step="0.1" placeholder="8"></div>
        <div class="row"><button class="btn primary" onclick="tripSave()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn" onclick="tripCancel()">–û—Ç–º–µ–Ω–∞</button></div>
      </div>

      <div id="daysList" style="margin-top:8px"></div>
    </div>
  </section>

  <!-- –£—á–∞—Å—Ç–∫–∏ -->
  <section id="v-sections" class="view">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <b>–£—á–∞—Å—Ç–∫–∏</b><button class="btn" onclick="sectionOpen()">–ù–æ–≤—ã–π —É—á–∞—Å—Ç–æ–∫</button>
      </div>
      <div id="sectionForm" class="card" style="display:none;margin-top:10px">
        <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="s_name"></div>
        <div class="row"><label>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</label><input id="s_from"></div>
        <div class="row"><label>–ü—Ä–∏–±—ã—Ç–∏–µ</label><input id="s_to"></div>
        <div class="row"><button class="btn primary" onclick="sectionSave()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="btn" onclick="sectionCancel()">–û—Ç–º–µ–Ω–∞</button></div>
      </div>
      <div id="sectionList"></div>
    </div>
  </section>

  <!-- –¢–∞—Ä–∏—Ñ—ã -->
  <section id="v-tariffs" class="view">
    <div class="card">
      <b>–¢–∞—Ä–∏—Ñ</b>
      <div class="row"><label>‚ÇΩ/—á–∞—Å</label><input id="tar_base" type="number" inputmode="decimal" placeholder="358.46"></div>
      <div class="row"><button class="btn primary" onclick="tarSave()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button></div>
    </div>
  </section>

  <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
  <section id="v-settings" class="view">
    <div class="card">
      <b>–ë—ç–∫–∞–ø</b>
      <div class="row"><button class="btn" onclick="backup()">–°–∫–∞—á–∞—Ç—å JSON</button></div>
      <div class="row"><input id="restoreFile" type="file" accept="application/json" onchange="restoreFileChanged(event)"></div>
      <div class="small" style="opacity:.8">–í–µ—Ä—Å–∏—è Lite 2025.25e (–∫–æ–º–ø–∞–∫—Ç–Ω–∞—è)</div>
    </div>
  </section>
</main>

<nav class="tabbar">
  <button class="active" data-tab="dashboard" onclick="nav(this)"><span class="ico">üè†</span>–ì–ª–∞–≤–Ω–∞—è</button>
  <button data-tab="sections" onclick="nav(this)"><span class="ico">üó∫Ô∏è</span>–£—á–∞—Å—Ç–∫–∏</button>
  <button data-tab="tariffs" onclick="nav(this)"><span class="ico">üí≥</span>–¢–∞—Ä–∏—Ñ</button>
  <button data-tab="settings" onclick="nav(this)"><span class="ico">‚öôÔ∏è</span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<script>
function $(s){return document.querySelector(s)}
function $all(s){return Array.from(document.querySelectorAll(s))}
function S(k,v){if(arguments.length===2){localStorage.setItem(k,JSON.stringify(v));return v}try{let r=localStorage.getItem(k);return r?JSON.parse(r):null}catch(e){return null}}
function toNum(v){let n=Number(v);return isNaN(n)?0:n}
function fmtM(min){let h=Math.floor(min/60),m=min%60;return h+'—á '+String(m).padStart(2,'0')+'–º'}

function nav(btn){$all('.tabbar button').forEach(x=>x.classList.remove('active'));btn.classList.add('active');let v=btn.getAttribute('data-tab');$all('.view').forEach(x=>x.classList.remove('active'));$('#v-'+v).classList.add('active')}

function getTar(){return S('tar')||{base:358.46,norm:176}}
function tarSave(){let t=getTar();t.base=toNum($('#tar_base').value)||t.base;t.norm=toNum($('#tar_norm').value)||t.norm;S('tar',t);updateDash()}
function loadTar(){let t=getTar();$('#tar_base').value=t.base;$('#tar_norm').value=t.norm}

function getTrips(){return S('trips')||[]}
function setTrips(a){S('trips',a)}
function addTripOpen(){$('#tripForm').style.display='block';$('#t_date').value=new Date().toISOString().slice(0,10);$('#t_route').value='';$('#t_hours').value='8'}
function tripCancel(){$('#tripForm').style.display='none'}
function tripSave(){let arr=getTrips();arr.push({id:Date.now(),date:$('#t_date').value,route:$('#t_route').value.trim(),hours:toNum($('#t_hours').value)});setTrips(arr);$('#tripForm').style.display='none';renderTrips();updateDash()}
function tripDel(id){setTrips(getTrips().filter(x=>x.id!==id));renderTrips();updateDash()}
function renderTrips(){let box=$('#daysList');box.innerHTML='';let arr=getTrips().slice().sort((a,b)=>(a.date||'').localeCompare(b.date));if(!arr.length){let d=document.createElement('div');d.className='small';d.style.opacity=.7;d.textContent='–ù–µ—Ç –ø–æ–µ–∑–¥–æ–∫';box.appendChild(d)}arr.forEach(t=>{let row=document.createElement('div');row.className='trip';row.innerHTML='<div><b>'+t.date+'</b> ‚Ä¢ '+(t.route||'‚Äî')+'</div><div>'+t.hours+' —á</div><div><button class="btn" onclick="tripDel('+t.id+')">üóë</button></div>';box.appendChild(row)})}

function getSecs(){return S('secs')||[]}
function setSecs(a){S('secs',a)}
function sectionOpen(){$('#sectionForm').style.display='block';$('#s_name').value='';$('#s_from').value='';$('#s_to').value=''}
function sectionCancel(){$('#sectionForm').style.display='none'}
function sectionSave(){let a=getSecs();a.push({id:Date.now(),name:$('#s_name').value.trim(),frm:$('#s_from').value.trim(),to:$('#s_to').value.trim()});setSecs(a);$('#sectionForm').style.display='none';renderSecs()}
function sectionDel(id){setSecs(getSecs().filter(x=>x.id!==id));renderSecs()}
function renderSecs(){let box=$('#sectionList');box.innerHTML='';let a=getSecs();if(!a.length){let d=document.createElement('div');d.className='small';d.style.opacity=.7;d.textContent='–ù–µ—Ç —É—á–∞—Å—Ç–∫–æ–≤';box.appendChild(d)}a.forEach(s=>{let r=document.createElement('div');r.className='row';r.innerHTML='<div style="flex:1"><b>'+ (s.name||'‚Äî') +'</b><div class="small" style="opacity:.7">'+(s.frm||'‚Äî')+' ‚Üí '+(s.to||'‚Äî')+'</div></div><button class="btn" onclick="sectionDel('+s.id+')">üóë</button>';box.appendChild(r)})}

function updateDash(){let t=getTar();let mins=Math.round((getTrips().reduce((a,x)=>a+toNum(x.hours),0))*60);let norm=t.norm*60;let pct=norm?Math.round(mins/norm*100):0;let rem=norm-mins;$('#mwNorm').textContent=t.norm+' —á';$('#mwWorked').textContent=fmtM(mins);$('#mwPercent').textContent=pct+'%';$('#mwRemain').textContent=rem>=0?('–û—Å—Ç–∞–ª–æ—Å—å: '+fmtM(rem)):('–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞: '+fmtM(-rem));$('#mwBar').style.width=Math.min(pct,100)+'%'}

function backup(){let data={tar:getTar(),trips:getTrips(),secs:getSecs()};let blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});let url=URL.createObjectURL(blob);let a=document.createElement('a');a.href=url;a.download='bm-backup.json';a.click();setTimeout(()=>URL.revokeObjectURL(url),500)}
function restoreFileChanged(e){let f=e.target.files[0];if(!f)return;let rd=new FileReader();rd.onload=()=>{try{let d=JSON.parse(rd.result);if(d.tar)S('tar',d.tar);if(d.trips)S('trips',d.trips);if(d.secs)S('secs',d.secs);init();alert('–ì–æ—Ç–æ–≤–æ')}catch(err){alert('–û—à–∏–±–∫–∞: '+err.message)}};rd.readAsText(f)}

function init(){loadTar();renderTrips();renderSecs();updateDash()}
init();
</script>
</body>
</html>
